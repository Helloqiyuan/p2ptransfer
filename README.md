# P2P文件传输工具

一个基于Java Socket的文件传输工具，使用IPv6网络，支持断点续传。

## 功能特点

- 基于Java Socket实现可靠文件传输
- 使用IPv6地址连接
- 具备断点续传功能
- 文件传输进度实时显示
- MD5校验保证文件完整性
- 自动获取可用端口
- 自动检测本机IPv6地址

## 项目结构

```
src/
└── main/
    └── java/
        └── com/qiyuan/
            ├── P2P.java        # 文件传输核心实现
            ├── pojo/           # 数据传输对象
            ├── test/           # 程序入口
            ├── utils/          # 工具类
            └── cs/             # 客户端-服务器通信模块
                ├── Client.java # 客户端实现，支持发送和接收模式
                └── Server.java # 服务器实现，用于协调客户端连接
```

## 客户端-服务器通信模块(cs包)

新增的客户端-服务器通信模块提供了更友好的用户界面和房间号匹配机制：

### Client.java
- 提供交互式菜单选择发送或接收文件
- 实现房间号机制，发送者和接收者通过房间号进行配对
- 自动处理IPv6地址检测和端口分配
- 支持文件拖放选择和文件选择器两种方式选择文件

### Server.java
- 使用多线程处理多个客户端连接
- 维护房间号与接收者连接信息的映射关系
- 为接收者自动生成唯一的房间号
- 协调发送者和接收者的连接匹配

## 使用方法

### 编译项目

```bash
mvn clean package
```

### 运行程序

项目提供了两种使用方式：

#### 方式一：使用cs包（推荐）

这是新的客户端-服务器模式，提供更友好的交互界面和房间号匹配机制：

```bash
java -cp p2p.jar com.qiyuan.cs.Client
```

运行后根据提示选择操作模式（发送或接收文件），系统会自动分配房间号或要求输入房间号。

#### 方式二：使用test包（传统方式）

##### 接收文件

```bash
java -jar p2p.jar
```

或者

```bash
java -cp p2p.jar com.qiyuan.test.Receive
```

##### 发送文件

```bash
java -cp p2p.jar com.qiyuan.test.Send
```

## 配置说明

在[P2P.java](src/main/java/com/qiyuan/P2P.java)中可以修改以下配置：

```java
private int cache = 1024 * 1024; // 缓冲区大小(1MB)
```

## 文件存储

- 发送文件: 通过拖拽或文件选择器选择任意文件
- 接收文件: 自动保存在 `./Receive` 目录下

## 技术要点

1. 使用Java Socket编程实现TCP连接
2. 通过序列化传输文件元数据(Doc对象)
3. 断点续传通过记录已传输字节数实现
4. 使用Lombok简化JavaBean代码
5. Maven构建项目，使用shade插件打包
6. 支持大文件传输和进度显示
7. 自动IPv6地址检测和端口分配

## 依赖项

- Lombok 1.18.40

## 注意事项

1. 确保网络环境支持IPv6
2. 防火墙需要允许指定端口通信(默认使用自动分配的端口)
3. 发送大文件时请确保磁盘空间充足
4. 断点续传功能在接收方实现，会在Receive目录下创建.ucf临时文件
5. 程序默认将接收方作为JAR包的主类（通过pom.xml中的配置指定）